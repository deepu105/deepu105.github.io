<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="icon" href="/assets/images/logo.png">

    <title>Deploy a web app to Azure App Service using Terraform | Technorage</title>

    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Deploy a web app to Azure App Service using Terraform | Technorage</title>
<meta name="generator" content="Jekyll v2.0.0" />
<meta property="og:title" content="Deploy a web app to Azure App Service using Terraform" />
<meta name="author" content="deepu" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Deploy a web app to Azure App Service using Terraform" />
<meta property="og:description" content="Deploy a web app to Azure App Service using Terraform" />
<meta property="og:site_name" content="Technorage" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-06-12T00:00:00+02:00" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"deepu"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/assets/images/logo.png"},"name":"deepu"},"description":"Deploy a web app to Azure App Service using Terraform","@type":"BlogPosting","headline":"Deploy a web app to Azure App Service using Terraform","dateModified":"2019-06-12T00:00:00+02:00","datePublished":"2019-06-12T00:00:00+02:00","url":"https://deepu.js.org/deploy-a-web-app-to-azure-app-service-using-terraform","mainEntityOfPage":{"@type":"WebPage","@id":"https://deepu.js.org/deploy-a-web-app-to-azure-app-service-using-terraform"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
        
    <link href="/assets/css/screen.css" rel="stylesheet">

    <link href="/assets/css/main.css" rel="stylesheet">

    <script src="/assets/js/jquery.min.js"></script>

</head>




<body class="layout-post">
	<!-- defer loading of font and font awesome -->
	<noscript id="deferred-styles">
		<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.9.0/css/all.css" crossorigin="anonymous">
	</noscript>


<!-- Begin Menu Navigation
================================================== -->
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down pr-md-0 pl-md-0">

    <div class="container">

    <!-- Begin Logo -->
    <a class="navbar-brand" href="/">
        <h2>Deepu K Sasidharan</h2>
    </a>
    <!-- End Logo -->

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarMediumish">

        <!-- Begin Menu -->

            <ul class="navbar-nav ml-auto">

                
                <li class="nav-item">
                
                    <a class="nav-link" href="/">About</a>
                </li>
            
                
                <li class="nav-item active">
                
                    <a class="nav-link" href="/blogs/"><i class="fas fa-blog"></i> Blog</a>
                </li>

                <li class="nav-item">
                    <a target="_blank" class="nav-link" href="https://www.packtpub.com/eu/application-development/full-stack-development-jhipster"><i class="fas fa-book"></i> Book</a>
                </li>

                <li class="nav-item">
                    <a target="_blank" class="nav-link" href="https://www.youtube.com/playlist?list=PLxayiD7e52nPpb-sSaoOPc-zXGhmOaNHK"><i class="fab fa-youtube"></i> Videos</a>
                </li>

                <li class="nav-item">
                    <a target="_blank" class="nav-link" href="https://speakerdeck.com/deepu105"><i class="fab fa-speaker-deck"></i> Presentations</a>
                </li>

                <script src="/assets/js/lunr.js"></script>


<style>
    .lunrsearchresult .title {color: #d9230f;}
    .lunrsearchresult .url {color: silver;}
    .lunrsearchresult a {display: block; color: #777;}
    .lunrsearchresult a:hover, .lunrsearchresult a:focus {text-decoration: none;}
    .lunrsearchresult a:hover .title {text-decoration: underline;}
</style>


<form class="bd-search" onSubmit="return lunr_search(document.getElementById('lunrsearch').value);">
    <input type="text" class="form-control text-small launch-modal-search" id="lunrsearch" name="q" maxlength="255" value="" placeholder="Type and enter..."/>
</form>

<div id="lunrsearchresults">
    <ul></ul>
</div>

<script src="/assets/js/lunrsearchengine.js"></script>

            </ul>

        <!-- End Menu -->

    </div>

    </div>
</nav>
<!-- End Navigation
================================================== -->

<div class="site-content">

<div class="container">

<!-- Content
================================================== -->
<div class="main-content">
    <!-- Site Title
================================================== -->
<div class="mainheading">
    <h1 class="sitetitle">Technorage</h1>
    <p class="lead">
        Where I rage about technology and stuff!
    </p>
</div>
<!-- Begin Article
================================================== -->
<div class="container">
    <div class="row">

        <!-- Post Share -->
        <div class="col-md-2 pl-0">
            <div class="share sticky-top sticky-top-offset">
    <p>
        Share
    </p>
    <ul>
        <li class="ml-1 mr-1">
            <a target="_blank" href="https://twitter.com/intent/tweet?text=Deploy a web app to Azure App Service using Terraform&url=https://deepu.js.org//deploy-a-web-app-to-azure-app-service-using-terraform/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fab fa-twitter"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://facebook.com/sharer.php?u=https://deepu.js.org//deploy-a-web-app-to-azure-app-service-using-terraform/" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;">
                <i class="fab fa-facebook-f"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=https://deepu.js.org//deploy-a-web-app-to-azure-app-service-using-terraform/" onclick="window.open(this.href, 'width=550,height=435');return false;">
                <i class="fab fa-linkedin-in"></i>
            </a>
        </li>

    </ul>
    
    <div class="sep">
    </div>
    <ul>
        <li>
        <a class="small smoothscroll" href="#disqus_thread"></a>
        </li>
    </ul>
    

</div>

        </div>

        <!-- Post -->
        

        <div class="col-md-9 flex-first flex-md-unordered">
            <div class="mainheading">

                <!-- Author Box -->
                
                <div class="row post-top-meta">
                    <div class="col-xs-12 col-md-3 col-lg-2 text-center text-md-left mb-4 mb-md-0">
                        
                        <img class="author-thumb" src="https://www.gravatar.com/avatar/7f408bc67dc9ae3b288ee92d16d3c4c2?s=250&d=mm&r=x" alt="Deepu K Sasidharan">
                        
                    </div>
                    <div class="col-xs-12 col-md-9 col-lg-10 text-center text-md-left">
                        <a target="_blank" class="link-dark" href="https://www.deepu.tech">Deepu K Sasidharan</a><a target="_blank" href="https://twitter.com/deepu105" class="btn follow">Follow</a>
                        <span class="author-description">JHipster co-lead, Java, JS, Cloud Native Advocate, Dev @ XebiaLabs, Author, Speaker, Software craftsman. Loves simple & beautiful code. bit.ly/JHIPSTER-BOOK</span>
                        <!-- Post Date -->
                        <span class="author-description">
                            <small>
                                <time class="post-date" datetime="2019-06-12">12 Jun 2019</time>
                                
                            </small> |
                            <small>10 mins read</small>
                        </span>
                    </div>
                </div>
                

                <!-- Post Title -->
                <h1 class="posttitle">Deploy a web app to Azure App Service using Terraform</h1>

            </div>

            <!-- Adsense if enabled from _config.yml (change your pub id and slot) -->
            
            <!-- End Adsense -->

            <!-- Post Featured Image -->
            

                
                    <img class="featured-image img-fluid lazyimg" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAACCAQAAAA3fa6RAAAADklEQVR42mNkAANGCAUAACMAA2w/AMgAAAAASUVORK5CYII=" data-src="https://thepracticaldev.s3.amazonaws.com/i/8mb4tyleqthxsvl1yxy6.png" alt="Deploy a web app to Azure App Service using Terraform">
                

            
            <!-- End Featured Image -->

            <!-- Post series -->
            
            <!-- End series -->

            <!-- Post Content -->
            <div class="article-post">
                <!-- Toc if any -->
                
                <!-- End Toc -->
                <p>Deploying Java web applications to Azure is easy and has been tried, tested and explained many times by many people. My friend <a href="https://dev.to/jdubois">Julien Dubois</a> has a nice series on it <a href="https://dev.to/azure/creating-a-spring-boot-and-angular-application-for-azure-1-7-2mb8">here</a>. Azure makes it really easy to use its <a href="https://azure.microsoft.com/en-gb/services/app-service/">App Service</a> as it provides many different ways of deploying a web app.</p>

<p>If you are a modern full-stack Java developer there is a high chance that you are deploying your application as a Docker image. Hence today let’s see how we can deploy a Java web application to Azure App Service using Docker and Terraform in the true spirit of infrastructure as code. The approach is pretty much the same for any web application that is built as a docker image and not necessarily tied down to just Java.</p>

<p>To try this out you would need to have <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java</a>, <a href="https://nodejs.org/en/download/">NodeJS</a>, <a href="https://www.terraform.io/">Terraform</a>, <a href="https://docs.docker.com/install/">Docker</a> and <a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Azure CLI</a> installed. Follow the links to install them if needed.</p>

<p>As one of the lead developer of <a href="https://www.jhipster.tech">JHipster</a> (A handy development platform to generate, develop and deploy Spring Boot + Angular/React/Vue Web applications and Spring microservices), I would use a JHipster web application as the example here. So let’s get started.</p>

<p>Let’s build a very simple web application using JHipster. We will use the <a href="https://www.jhipster.tech/jdl/">JDL</a> feature to scaffold our application.</p>

<p>We will use the below JDL for our application. Save it to a file named <code class="highlighter-rouge">app.jdl</code> in a directory where you want to create the application.</p>

<pre><code class="language-jdl">application {
    config {
        baseName helloJHipster,
        applicationType monolith,
        packageName tech.jhipster.demo,
        authenticationType jwt,
        buildTool gradle,
        clientFramework react,
        databaseType sql,
        prodDatabaseType mysql,
        languages [en, nl]
    }
}

</code></pre>

<p>Now let us scaffold this using JHipster. Open your favorite console/terminal and run the below command in the directory where you saved the above JDL file, make sure it’s an empty directory.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>npx generator-jhipster import-jdl app.jdl
</pre></td></tr></tbody></table></code></pre></div></div>

<p>If you already have JHipster <a href="https://www.jhipster.tech/installation/">installed</a> you can just run</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>jhipster import-jdl app.jdl
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This will scaffold the application and install the required client-side dependencies. It might take a few minutes(NPM!) so maybe its time for that coffee.</p>

<p>You can see the application in action by running <code class="highlighter-rouge">./gradlew</code> on the same terminal once the scaffolding is done. You can refer to the generated <code class="highlighter-rouge">Readme.md</code> for more instructions regarding the application.</p>

<p>Now let’s move on to the focus of this post, deploying this to Azure App Service with Terraform. Let us first build and publish the docker image for our application.</p>

<p>JHipster conveniently provides everything that is required to build docker images. Let us use the provided docker integration using <a href="https://github.com/GoogleContainerTools/jib">JIB</a> to build the images. Run the below Gradle command.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>./gradlew bootJar <span class="nt">-Pprod</span> jibDockerBuild
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Now let us tag and push this to our docker registry, make sure you have <a href="https://docs.docker.com/engine/reference/commandline/login/">logged into docker</a> and run these commands. Use your own docker hub account name.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>docker tag hellojhipster:latest deepu105/hellojhipster:latest
<span class="nv">$ </span>docker push deepu105/hellojhipster:latest

</pre></td></tr></tbody></table></code></pre></div></div>
<p>You can also push to Azure Container registry instead of Docker Hub if you like.</p>

<p>Now that our application and Docker images are ready, let’s prepare the Terraform infrastructure for App Service and MySQL database. For other ways of deploying a JHipster web app to Azure check <a href="https://www.jhipster.tech/azure/">this</a> out.</p>

<p>First, create a folder for our terraform files. Let’s name the folder <code class="highlighter-rouge">terraform</code>.</p>

<p>Now create three files called <code class="highlighter-rouge">main.tf</code>, <code class="highlighter-rouge">outputs.tf</code>, and <code class="highlighter-rouge">variables.tf</code> in this folder.</p>

<p>Let us define the variables we will use. Save the below in <code class="highlighter-rouge">variables.tf</code>.</p>

<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="rouge-code"><pre><span class="nx">variable</span> <span class="s2">"prefix"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"The prefix used for all resources in this example"</span>
  <span class="nx">default</span>     <span class="p">=</span> <span class="s2">"xl"</span>
<span class="p">}</span>

<span class="nx">variable</span> <span class="s2">"location"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"The Azure location where all resources in this example should be created"</span>
<span class="p">}</span>

<span class="nx">variable</span> <span class="s2">"subscription_id"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"Azure Subscription ID to be used for billing"</span>
<span class="p">}</span>

<span class="nx">variable</span> <span class="s2">"my_sql_master_password"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"MySql master password"</span>
<span class="p">}</span>

<span class="nx">variable</span> <span class="s2">"docker_image"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"Docker image name"</span>
<span class="p">}</span>

<span class="nx">variable</span> <span class="s2">"docker_image_tag"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"Docker image tag"</span>
<span class="p">}</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>Now let us define our <code class="highlighter-rouge">main.tf</code></p>

<p>First, let us add a configuration for Azure resource manager and create an Azure resource group to hold our resources.</p>

<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="nx">provider</span> <span class="s2">"azurerm"</span> <span class="p">{</span>
  <span class="nx">version</span>         <span class="p">=</span> <span class="s2">"=1.24.0"</span>
  <span class="nx">subscription_id</span> <span class="p">=</span> <span class="s2">"${var.subscription_id}"</span>
<span class="p">}</span>

<span class="nx">resource</span> <span class="s2">"azurerm_resource_group"</span> <span class="s2">"main"</span> <span class="p">{</span>
  <span class="nx">name</span>     <span class="p">=</span> <span class="s2">"${var.prefix}-resources"</span>
  <span class="nx">location</span> <span class="p">=</span> <span class="s2">"${var.location}"</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Now let us add the configuration to create a <a href="https://www.terraform.io/docs/providers/azurerm/r/mysql_server.html">MySQL database server</a> along with the required firewall rules to let App Service access the DB. If you want to add local access from your machine add a firewall rule block for your IP as well.</p>

<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre></td><td class="rouge-code"><pre><span class="c1"># This creates a MySQL server</span>
<span class="nx">resource</span> <span class="s2">"azurerm_mysql_server"</span> <span class="s2">"main"</span> <span class="p">{</span>
  <span class="nx">name</span>                <span class="p">=</span> <span class="s2">"${var.prefix}-mysql-server"</span>
  <span class="nx">location</span>            <span class="p">=</span> <span class="s2">"${azurerm_resource_group.main.location}"</span>
  <span class="nx">resource_group_name</span> <span class="p">=</span> <span class="s2">"${azurerm_resource_group.main.name}"</span>

  <span class="nx">sku</span> <span class="p">{</span>
    <span class="nx">name</span>     <span class="p">=</span> <span class="s2">"B_Gen5_2"</span>
    <span class="nx">capacity</span> <span class="p">=</span> <span class="mi">2</span>
    <span class="nx">tier</span>     <span class="p">=</span> <span class="s2">"Basic"</span>
    <span class="nx">family</span>   <span class="p">=</span> <span class="s2">"Gen5"</span>
  <span class="p">}</span>

  <span class="nx">storage_profile</span> <span class="p">{</span>
    <span class="nx">storage_mb</span>            <span class="p">=</span> <span class="mi">5120</span>
    <span class="nx">backup_retention_days</span> <span class="p">=</span> <span class="mi">7</span>
    <span class="nx">geo_redundant_backup</span>  <span class="p">=</span> <span class="s2">"Disabled"</span>
  <span class="p">}</span>

  <span class="nx">administrator_login</span>          <span class="p">=</span> <span class="s2">"mysqladminun"</span>
  <span class="nx">administrator_login_password</span> <span class="p">=</span> <span class="s2">"${var.my_sql_master_password}"</span>
  <span class="nx">version</span>                      <span class="p">=</span> <span class="s2">"5.7"</span>
  <span class="nx">ssl_enforcement</span>              <span class="p">=</span> <span class="s2">"Disabled"</span>
<span class="p">}</span>

<span class="c1"># This is the database that our application will use</span>
<span class="nx">resource</span> <span class="s2">"azurerm_mysql_database"</span> <span class="s2">"main"</span> <span class="p">{</span>
  <span class="nx">name</span>                <span class="p">=</span> <span class="s2">"${var.prefix}_mysql_db"</span>
  <span class="nx">resource_group_name</span> <span class="p">=</span> <span class="s2">"${azurerm_resource_group.main.name}"</span>
  <span class="nx">server_name</span>         <span class="p">=</span> <span class="s2">"${azurerm_mysql_server.main.name}"</span>
  <span class="nx">charset</span>             <span class="p">=</span> <span class="s2">"utf8"</span>
  <span class="nx">collation</span>           <span class="p">=</span> <span class="s2">"utf8_unicode_ci"</span>
<span class="p">}</span>

<span class="c1"># This rule is to enable the 'Allow access to Azure services' checkbox</span>
<span class="nx">resource</span> <span class="s2">"azurerm_mysql_firewall_rule"</span> <span class="s2">"main"</span> <span class="p">{</span>
  <span class="nx">name</span>                <span class="p">=</span> <span class="s2">"${var.prefix}-mysql-firewall"</span>
  <span class="nx">resource_group_name</span> <span class="p">=</span> <span class="s2">"${azurerm_resource_group.main.name}"</span>
  <span class="nx">server_name</span>         <span class="p">=</span> <span class="s2">"${azurerm_mysql_server.main.name}"</span>
  <span class="nx">start_ip_address</span>    <span class="p">=</span> <span class="s2">"0.0.0.0"</span>
  <span class="nx">end_ip_address</span>      <span class="p">=</span> <span class="s2">"0.0.0.0"</span>
<span class="p">}</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>This will create a MySQL server, a database for our app on the server and enable access from App Service.</p>

<p>Now let us configure the <a href="https://www.terraform.io/docs/providers/azurerm/r/app_service.html">App Service</a> itself along with a service plan.</p>

<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre></td><td class="rouge-code"><pre><span class="c1"># This creates the plan that the service use</span>
<span class="nx">resource</span> <span class="s2">"azurerm_app_service_plan"</span> <span class="s2">"main"</span> <span class="p">{</span>
  <span class="nx">name</span>                <span class="p">=</span> <span class="s2">"${var.prefix}-asp"</span>
  <span class="nx">location</span>            <span class="p">=</span> <span class="s2">"${azurerm_resource_group.main.location}"</span>
  <span class="nx">resource_group_name</span> <span class="p">=</span> <span class="s2">"${azurerm_resource_group.main.name}"</span>
  <span class="nx">kind</span>                <span class="p">=</span> <span class="s2">"Linux"</span>
  <span class="nx">reserved</span>            <span class="p">=</span> <span class="kc">true</span>

  <span class="nx">sku</span> <span class="p">{</span>
    <span class="nx">tier</span> <span class="p">=</span> <span class="s2">"Standard"</span>
    <span class="nx">size</span> <span class="p">=</span> <span class="s2">"S1"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># This creates the service definition</span>
<span class="nx">resource</span> <span class="s2">"azurerm_app_service"</span> <span class="s2">"main"</span> <span class="p">{</span>
  <span class="nx">name</span>                <span class="p">=</span> <span class="s2">"${var.prefix}-appservice"</span>
  <span class="nx">location</span>            <span class="p">=</span> <span class="s2">"${azurerm_resource_group.main.location}"</span>
  <span class="nx">resource_group_name</span> <span class="p">=</span> <span class="s2">"${azurerm_resource_group.main.name}"</span>
  <span class="nx">app_service_plan_id</span> <span class="p">=</span> <span class="s2">"${azurerm_app_service_plan.main.id}"</span>

  <span class="nx">site_config</span> <span class="p">{</span>
    <span class="nx">app_command_line</span> <span class="p">=</span> <span class="s2">""</span>
    <span class="nx">linux_fx_version</span> <span class="p">=</span> <span class="s2">"DOCKER|${var.docker_image}:${var.docker_image_tag}"</span>
    <span class="nx">always_on</span>        <span class="p">=</span> <span class="kc">true</span>
  <span class="p">}</span>

  <span class="nx">app_settings</span> <span class="p">=</span> <span class="p">{</span>
    <span class="s2">"WEBSITES_ENABLE_APP_SERVICE_STORAGE"</span> <span class="p">=</span> <span class="s2">"false"</span>
    <span class="s2">"DOCKER_REGISTRY_SERVER_URL"</span>          <span class="p">=</span> <span class="s2">"https://index.docker.io"</span>

    <span class="c1"># These are app specific environment variables</span>
    <span class="s2">"SPRING_PROFILES_ACTIVE"</span>     <span class="p">=</span> <span class="s2">"prod,swagger"</span>
    <span class="s2">"SPRING_DATASOURCE_URL"</span>      <span class="p">=</span> <span class="s2">"jdbc:mysql://${azurerm_mysql_server.main.fqdn}:3306/${azurerm_mysql_database.main.name}?useUnicode=true&amp;characterEncoding=utf8&amp;useSSL=false&amp;useLegacyDatetimeCode=false&amp;serverTimezone=UTC"</span>
    <span class="s2">"SPRING_DATASOURCE_USERNAME"</span> <span class="p">=</span> <span class="s2">"${azurerm_mysql_server.main.administrator_login}@${azurerm_mysql_server.main.name}"</span>
    <span class="s2">"SPRING_DATASOURCE_PASSWORD"</span> <span class="p">=</span> <span class="s2">"${var.my_sql_master_password}"</span>
  <span class="p">}</span>
<span class="p">}</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>In this configuration, under <code class="highlighter-rouge">site_config</code> we use <code class="highlighter-rouge">linux_fx_version</code> to declare our docker image and set <code class="highlighter-rouge">always_on</code> to true so that the application is not shut down when there is inactivity for some time.</p>

<p>In the <code class="highlighter-rouge">app_settings</code> section we need to disable storage using the flag <code class="highlighter-rouge">WEBSITES_ENABLE_APP_SERVICE_STORAGE</code> and also specify <code class="highlighter-rouge">DOCKER_REGISTRY_SERVER_URL</code>. Everything else is specific to our app. The flags passed to the MySQL connection URL is important.</p>

<p>Now that our <code class="highlighter-rouge">main.tf</code> is ready let us define some output properties that are handy. In the <code class="highlighter-rouge">outputs.tf</code> file add the below</p>

<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="nx">output</span> <span class="s2">"app_service_name"</span> <span class="p">{</span>
  <span class="nx">value</span> <span class="p">=</span> <span class="s2">"${azurerm_app_service.main.name}"</span>
<span class="p">}</span>

<span class="nx">output</span> <span class="s2">"app_service_default_hostname"</span> <span class="p">{</span>
  <span class="nx">value</span> <span class="p">=</span> <span class="s2">"https://${azurerm_app_service.main.default_site_hostname}"</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Now we are ready to rock and roll! let us deploy the app. Make sure you have set up your Azure CLI and have <a href="https://docs.microsoft.com/en-us/cli/azure/authenticate-azure-cli?view=azure-cli-latest">logged in</a> using <code class="highlighter-rouge">az login</code>. Now in a terminal/console navigate to the <code class="highlighter-rouge">terraform</code> folder we created and execute these commands. Please change the values for <code class="highlighter-rouge">prefix</code>, <code class="highlighter-rouge">location</code> &amp; <code class="highlighter-rouge">docker_image</code> accordingly.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>terraform init

<span class="nv">$ </span>terraform apply <span class="se">\</span>
<span class="nt">-var</span> <span class="nv">prefix</span><span class="o">=</span>myAwesomeApp <span class="se">\</span>
<span class="nt">-var</span> <span class="nv">location</span><span class="o">=</span>northeurope <span class="se">\</span>
<span class="nt">-var</span> <span class="nv">docker_image</span><span class="o">=</span>deepu105/hellojhipster <span class="se">\</span>
<span class="nt">-var</span> <span class="nv">docker_image_tag</span><span class="o">=</span>latest
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This will prompt you to enter a master password for MySQL server and your Azure subscription ID(You can find this from Azure portal or by running <code class="highlighter-rouge">az account list</code>- the <code class="highlighter-rouge">id</code> field is the subscription ID). Once you provide the values and confirm, Terraform will get to work and will start creating the resources. this could take a while since we are provisioning a Database server. Wait for it or go have that second coffee ;)</p>

<p>Once the deployment is complete, Terraform will print out the outputs which include the <code class="highlighter-rouge">app_service_default_hostname</code>. Copy the URL and open it in your favorite browser. The first time could take a while since the app will be started(cold start) only during the first request.</p>

<p><img src="https://thepracticaldev.s3.amazonaws.com/i/t5kcj7r3r9w6bxghe350.png" alt="" /></p>

<p>I hope you found this useful. This is my first post in <a href="https://dev.to/deepu105">dev.to</a>, I hope to migrate my blogs from <a href="https://medium.com/@deepu105">Medium</a> to <a href="https://dev.to/deepu105">dev.to</a> soon.</p>

<p>If you like this article, please leave a like or a comment.</p>

<p>You can follow me on <a href="https://twitter.com/deepu105">Twitter</a> and <a href="https://www.linkedin.com/in/deepu05/">LinkedIn</a>.</p>

<p>My other related posts:</p>

<ul>
  <li><a href="https://medium.com/@deepu105/create-full-microservice-stack-using-jhipster-domain-language-under-30-minutes-ecc6e7fc3f77">Create full Microservice stack using JHipster Domain Language under 30 minutes</a></li>
  <li><a href="https://medium.com/@deepu105/deploying-jhipster-microservices-on-azure-kubernetes-service-aks-fb46991746ba">Deploying JHipster Microservices on Azure Kubernetes Service (AKS)</a></li>
  <li><a href="https://medium.freecodecamp.org/jhipster-microservices-with-istio-service-mesh-on-kubernetes-a7d0158ba9a3">How to set up JHipster microservices with Istio service mesh on Kubernetes</a></li>
  <li><a href="https://medium.com/xebialabs/continuous-delivery-of-microservices-with-xebialabs-a-k-a-devops-as-code-b5f0c3b2b1c8">Continuous delivery of Microservices with XebiaLabs — a.k.a DevOps as Code</a></li>
</ul>

            </div>

            <!-- Rating -->
            


            <!-- Post Categories -->
            <div class="after-post-cats">
                <ul class="tags mb-4">
                    
                    
                </ul>
            </div>
            <!-- End Categories -->

            <!-- Post Tags -->
            <div class="after-post-tags">
                <ul class="tags">
                    
                    
                    <li>
                        <a class="smoothscroll" href="/tags#azure,">#azure,</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/tags#java,">#java,</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/tags#jhipster,">#jhipster,</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/tags#terraform">#terraform</a>
                    </li>
                    
                </ul>
            </div>
            <!-- End Tags -->

            <!-- Prev/Next -->
            <div class="row PageNavigation d-flex justify-content-between font-weight-bold">
            
            <a class="prev d-block col-md-6" href="/create-full-microservice-stack-using-j-hipster-domain-language-under-30-minutes/"> &laquo; Create full Microservice stack using JHipster Domain Language under 30 minutes</a>
            
            
            <a class="next d-block col-md-6 text-lg-right" href="/why-im-moving-away-from-medium/">Why I’m moving away from Medium &raquo; </a>
            
            <div class="clearfix"></div>
            </div>
            <!-- End Categories -->

        </div>
        <!-- End Post -->

    </div>
</div>
<!-- End Article
================================================== -->

<!-- Begin Comments
================================================== -->

    <div class="container">
        <div id="comments" class="row justify-content-center mb-5">
            <div class="col-md-8">
                <section class="disqus">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'deepu-tech'; 
        var disqus_developer = 0;
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = window.location.protocol + '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>

            </div>
        </div>
    </div>

<!--End Comments
================================================== -->

<!-- Review with LD-JSON, adapt it for your needs if you like, but make sure you test the generated HTML source code first:
https://search.google.com/structured-data/testing-tool/u/0/
================================================== -->


</div>


    
</div>

<!-- Categories Jumbotron
================================================== -->
<div class="jumbotron fortags">
	<div class="d-md-flex h-100">
		<div class="col-md-4 transpdark align-self-center text-center h-100">
            <div class="d-md-flex align-items-center justify-content-center h-100">
                <h2 class="d-md-block align-self-center py-1 font-weight-light">Explore <span class="d-none d-md-inline">→</span></h2>
            </div>
		</div>
		<div class="col-md-8 p-5 align-self-center text-center">
            
            
                
                    <a class="mt-1 mb-1" href="/tags#jhipster,">jhipster, (3)</a>
                
                    <a class="mt-1 mb-1" href="/tags#java,">java, (2)</a>
                
                    <a class="mt-1 mb-1" href="/tags#microservices,">microservices, (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#docker">docker (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#azure,">azure, (2)</a>
                
                    <a class="mt-1 mb-1" href="/tags#terraform">terraform (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#writing,">writing, (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#medium,">medium, (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#development,">development, (3)</a>
                
                    <a class="mt-1 mb-1" href="/tags#tech">tech (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#linux,">linux, (3)</a>
                
                    <a class="mt-1 mb-1" href="/tags#fedora,">fedora, (2)</a>
                
                    <a class="mt-1 mb-1" href="/tags#gnome">gnome (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#kubernetes,">kubernetes, (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#microservices">microservices (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#gnome,">gnome, (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#desktop">desktop (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#terminal,">terminal, (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#oh-my-zsh,">oh-my-zsh, (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#zsh">zsh (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#go,">go, (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#programming,">programming, (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#languages,">languages, (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#thepragmaticprogrammer">thepragmaticprogrammer (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#typescript,">typescript, (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#react,">react, (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#javascript,">javascript, (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#webdev">webdev (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#vscode,">vscode, (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#ide,">ide, (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#opensource">opensource (1)</a>
                
            
            
		</div>
	</div>
</div>

<!-- Begin Footer
================================================== -->
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-6 text-center text-lg-left">
                Copyright © 2019 Deepu K Sasidharan 
            </div>
            <div class="col-md-6 col-sm-6 text-center text-lg-right">    
                <a target="_blank" href="https://www.wowthemes.net/mediumish-free-jekyll-template/">Mediumish Jekyll Theme</a> by WowThemes.net |
                Domain by 
                <a href="https://js.org" target="_blank" title="JS.ORG | JavaScript Community">
                    <img src="https://logo.js.org/dark_tiny.png" style="width:50px" alt="JS.ORG Logo">
                </a> | 
                Hosted with <i class="far fa-heart"></i> by <a href="https://pages.github.com/" target="_blank">Github</a>
            </div>
        </div>
    </div>
</footer>
<!-- End Footer
================================================== -->

</div> <!-- /.site-content -->

<!-- Scripts
================================================== -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

<script src="/assets/js/mediumish.js"></script>


<script src="/assets/js/lazyload.js"></script>


<script src="/assets/js/ie10-viewport-bug-workaround.js"></script> 


<script id="dsq-count-scr" src="//deepu-tech.disqus.com/count.js"></script>


</body>
</html>
